{"componentChunkName":"component---src-templates-blog-post-js","path":"/atWork/npm-audit-fix/","result":{"data":{"site":{"siteMetadata":{"title":"Today I Learned...","author":"장호현","siteUrl":"https://guest-01.github.io/TIL","comment":{"disqusShortName":"","utterances":"Guest-01/blog-comments"},"sponsor":{"buyMeACoffeeId":""}}},"markdownRemark":{"id":"3726447f-59fb-5b30-9b52-ccaf3dfa2599","excerpt":"오늘은 빌드 시에 발생하는 취약성 로그를 해결하라는 요청을 받았습니다. 저희 솔루션은  스크립트를 이용하여 빌드를 하는데, 이때 가 함께 들어가있습니다. 때문에 빌드를 하게 되면 호환이 깨지지 않는 범위내에서 최대한 취약성을 제거하고 빌드를 하게 되는데, 이 문구가 나오지 않도록 개발단계에서 미리 패키지들을 업데이트해달라는 뜻입니다. 또한 로 해결되지 않은 채 빌드 되는 부분도 있어서 (하위 호환이 깨지는 경우에는 skip…","html":"<p>오늘은 빌드 시에 발생하는 취약성 로그를 해결하라는 요청을 받았습니다.</p>\n<p>저희 솔루션은 <code class=\"language-text\">make</code> 스크립트를 이용하여 빌드를 하는데, 이때 <code class=\"language-text\">npm audit fix</code>가 함께 들어가있습니다. 때문에 빌드를 하게 되면 호환이 깨지지 않는 범위내에서 최대한 취약성을 제거하고 빌드를 하게 되는데, 이 문구가 나오지 않도록 개발단계에서 미리 패키지들을 업데이트해달라는 뜻입니다. 또한 <code class=\"language-text\">npm audit fix</code>로 해결되지 않은 채 빌드 되는 부분도 있어서 (하위 호환이 깨지는 경우에는 skip하기 때문) 이 부분도 함께 해결을 해야했습니다.</p>\n<h2 id=\"사용하지-않는-패키지로부터-발생하는-취약점-제거\" style=\"position:relative;\"><a href=\"#%EC%82%AC%EC%9A%A9%ED%95%98%EC%A7%80-%EC%95%8A%EB%8A%94-%ED%8C%A8%ED%82%A4%EC%A7%80%EB%A1%9C%EB%B6%80%ED%84%B0-%EB%B0%9C%EC%83%9D%ED%95%98%EB%8A%94-%EC%B7%A8%EC%95%BD%EC%A0%90-%EC%A0%9C%EA%B1%B0\" aria-label=\"사용하지 않는 패키지로부터 발생하는 취약점 제거 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>사용하지 않는 패키지로부터 발생하는 취약점 제거</h2>\n<p>먼저 <code class=\"language-text\">npm audit</code>을 해보면 아래와 같이 총 130개의 취약점이 발견되었다고 뜨는 상태입니다.</p>\n<blockquote>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 864px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 24.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsSAAALEgHS3X78AAABB0lEQVQY03WQy1KEMBBF+Q15CQgDAcJrCCQZfFA4g+5dWqVf4Mb/r2v3lC5dnLp9k65+OYcsRd82qISArCrUZYmyKJBEMXzXg+958FyXYhdhECAKQ9wS4T84XVFiahQWPcEqBTOOkKJELxMihW5b2OEI0ykU8R1C9wYJN/F9eKy/+OQDaujoIcP72wGTGK/F7rXGg7HEjKfF4NEY7OuKk5pwbFp0tEVPCNpE1jUq3oo0yzJEUQRnXSW+v1IMscJle8Z+OeO8bXjdX2CpmJ5nGEJRM/Yna7EsC2Z6sxSzahqCCws6m6OmAp8fFWTeXT+YvyROKGkSTmZlz5NxnOf51Rd0b1aekPkBNHKZQn1VavUAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"최초-취약점-개수\"\n        title=\"최초-취약점-개수\"\n        src=\"/TIL/static/ce1cc35e44d9d0192418a8a4096c084f/9cab2/npm-audit-init.png\"\n        srcset=\"/TIL/static/ce1cc35e44d9d0192418a8a4096c084f/5a46d/npm-audit-init.png 300w,\n/TIL/static/ce1cc35e44d9d0192418a8a4096c084f/0a47e/npm-audit-init.png 600w,\n/TIL/static/ce1cc35e44d9d0192418a8a4096c084f/9cab2/npm-audit-init.png 864w\"\n        sizes=\"(max-width: 864px) 100vw, 864px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n</blockquote>\n<p>제가 제일 먼저 한 것은, <strong>실제로 사용하지 않는데 설치된 패키지들</strong>에 의해 발생하는 취약점을 제거하는 것입니다. 프로젝트를 처음 초기화 할 때, <code class=\"language-text\">@vue/cli</code>를 사용하였는데 이때 사용하지 않을 도구까지 함께 설치했던 것 같습니다. <code class=\"language-text\">package.json</code>안에 <code class=\"language-text\">dependencies</code>와 <code class=\"language-text\">devDependencies</code>를 보고 사용하지 않는 패키지가 있으면 삭제합니다. 아래와 같이 사용하지 않는 패키지들을 삭제하고 나니 확연히 줄어든 취약점 개수를 알 수 있었습니다.</p>\n<ol>\n<li><code class=\"language-text\">eslint-config-vuetify</code> 제거 후</li>\n</ol>\n<p><code class=\"language-text\">found 128 vulnerabilities (2 low, 30 moderate, 73 high, 23 critical)</code></p>\n<ol start=\"2\">\n<li><code class=\"language-text\">@vue/cli-plugin-e2e-cypress</code> 제거 후</li>\n</ol>\n<p><code class=\"language-text\">found 119 vulnerabilities (2 low, 27 moderate, 69 high, 21 critical)</code></p>\n<ol start=\"3\">\n<li><code class=\"language-text\">@vue/cli-plugin-unit-jest</code> 제거 후</li>\n</ol>\n<p><code class=\"language-text\">found 39 vulnerabilities (2 low, 10 moderate, 21 high, 6 critical)</code></p>\n<p>남은 <strong>39개</strong>의 취약점은 사용하고 있는 패키지로부터 발생하고 있었습니다.</p>\n<h2 id=\"npm-audit-production으로-다시-검사\" style=\"position:relative;\"><a href=\"#npm-audit-production%EC%9C%BC%EB%A1%9C-%EB%8B%A4%EC%8B%9C-%EA%B2%80%EC%82%AC\" aria-label=\"npm audit production으로 다시 검사 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>npm audit —production으로 다시 검사</h2>\n<p>위의 39개의 취약점을 모두 수정해야할 필요는 없었습니다. 확인해보니, <code class=\"language-text\">devDependecies</code>에 있는 항목들은 빌드 시에는 포함되지 않는 부분이므로 무시해도 괜찮습니다. npm v6 기준으로 <code class=\"language-text\">npm audit</code>을 할 경우 이 <code class=\"language-text\">devDependencies</code>까지 포함하여 검사를 하게 됩니다. 실제 빌드 시 사용되는 패키지들만 검사하고 싶다면 <code class=\"language-text\">--production</code>이라는 옵션을 주면 됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">[root@root nq-view-vuetify]# npm audit --production\n                                                                                \n                       === npm audit security report ===                        \n                                                                                \n# Run  npm install marked@4.0.16  to resolve 2 vulnerabilities\nSEMVER WARNING: Recommended action is a potentially breaking change\n┌───────────────┬──────────────────────────────────────────────────────────────┐\n│ High          │ Inefficient Regular Expression Complexity in marked          │\n├───────────────┼──────────────────────────────────────────────────────────────┤\n│ Package       │ marked                                                       │\n├───────────────┼──────────────────────────────────────────────────────────────┤\n│ Dependency of │ marked                                                       │\n├───────────────┼──────────────────────────────────────────────────────────────┤\n│ Path          │ marked                                                       │\n├───────────────┼──────────────────────────────────────────────────────────────┤\n│ More info     │ https://github.com/advisories/GHSA-5v2h-r2cx-5xgj            │\n└───────────────┴──────────────────────────────────────────────────────────────┘\n\n\n┌───────────────┬──────────────────────────────────────────────────────────────┐\n│ High          │ Inefficient Regular Expression Complexity in marked          │\n├───────────────┼──────────────────────────────────────────────────────────────┤\n│ Package       │ marked                                                       │\n├───────────────┼──────────────────────────────────────────────────────────────┤\n│ Dependency of │ marked                                                       │\n├───────────────┼──────────────────────────────────────────────────────────────┤\n│ Path          │ marked                                                       │\n├───────────────┼──────────────────────────────────────────────────────────────┤\n│ More info     │ https://github.com/advisories/GHSA-rrrm-qjm4-v8hf            │\n└───────────────┴──────────────────────────────────────────────────────────────┘\n\n\nfound 2 high severity vulnerabilities in 73 scanned packages\n  2 vulnerabilities require semver-major dependency updates.</code></pre></div>\n<p><code class=\"language-text\">npm audit --production</code> 결과는 위와 같습니다. <strong>단 2개</strong>의 <code class=\"language-text\">high</code> 취약점이 발견되었으며, 해결하기 위해서는 <code class=\"language-text\">marked</code> 패키지를 <code class=\"language-text\">4.0.16</code>으로 업데이트해야한다고 친절하게 알려줍니다. 다만 업데이트를 하게되면 호환성이 깨질 수 있다고 경고하네요. (<code class=\"language-text\">potentially breaking change</code>)</p>\n<p>해당 패키지는 저희 솔루션의 “도움말” 부분에 마크다운 문서를 렌더링하기 위해 사용하고 있었으며, 경고대로 <code class=\"language-text\">4.0.16</code>으로 업데이트 후에 도움말이 나오지 않는 문제가 발생했습니다. 이는 해당 패키지 문서를 참고하여 바뀐 API대로 코드를 수정해야합니다.</p>\n<p>코드를 수정하여 해결하였으며 최종 <code class=\"language-text\">npm audit --production</code>의 결과는 아래처럼 나옵니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">[root@root nq-view-vuetify]# npm audit --production\n                                                                                \n                       === npm audit security report ===                        \n                                                                                \nfound 0 vulnerabilities\n in 73 scanned packages</code></pre></div>","frontmatter":{"title":"npm audit으로 취약점 제거하기","date":"May 24, 2022"}}},"pageContext":{"slug":"/atWork/npm-audit-fix/","previous":{"fields":{"slug":"/atWork/disable-devtool/"},"frontmatter":{"title":"개발자도구 접근 차단하기"}},"next":{"fields":{"slug":"/atWork/web-security-with-arahcni/"},"frontmatter":{"title":"Arachni로 웹 취약점 개선하기"}}}}}